# AGENTS.md - Massage Therapy Coach Context

## 1. Project Overview
This project is a **mobile-first web app** designed to guide users through massage sessions. The core experience is "glanceable" and "audio-first", meaning the user can follow along without constantly looking at the screen, but can easily check their progress or the current step when needed.

**Primary Goal**: Enable users to explore gestures, run guided flows (sequences of gestures), and build custom flows.

## 2. Architecture & Tech Stack

### Frontend
- **Framework**: React + Vite + TypeScript
- **Styling**: Tailwind CSS v4 (using `@theme` and CSS variables)
- **Components**: `shadcn/ui` (Radix primitives) + custom `src/components/ui`
- **Animation**: Framer Motion (critical for "smooth 60fps" feel)
- **State Management**: Zustand (lightweight global state for Player & User Data)
- **Routing**: `react-router-dom` (or standard spa router)

### Content Pipeline (Local-First)
- **Source of Truth**: `src/content/gestures/*.json` & `src/content/flows/*.json`.
- **Runtime Access**: `src/content/generated/index.ts` (generated by `pnpm content:scan`).
- **Media**: Static assets in `public/media` or alongside content JSONs, referenced by relative paths.

### Persistence
- **Storage**: `localStorage` initially.
- **Data**: User flows, favorites, and session resume state (`activeFlowId`, `currentStepIndex`, `elapsedTime`).

## 3. Key Constraints & Guidelines

### UX / UI
- **Glanceability is King**: The specific "Guided Player" UI must use **massive typography** for countdowns and minimize distractions.
- **Audio-First**: The app must be usable with the screen off or peripheral. Use clear audio cues (Start, Halfway, Switch Side).
- **Motion**: Use `layoutId` for shared element transitions. All interactive elements must have press feedback.

### Code Style
- **Functional Components**: Use React Hooks.
- **Strict TypeScript**: No `any`. Define interfaces for all data structures (Gesture, Flow, Step).
- **Colocation**: Keep feature-specific components in `src/features/<feature>`.
- **Atomic Design**: Build small, reusable UI atoms in `src/components/ui`.

## 4. Workflows

### Adding a New Gesture
1. Run `pnpm content:new-gesture`.
2. Fill out the prompt (Name, Body Area, etc.).
3. Populate the generated `gesture.json` in `src/content/gestures/<slug>`.
4. Add media files (`audio.mp3`, `video.mp4`) to the same folder.
5. Run `pnpm content:validate` to check integrity.

### Building a Feature
1. check `docs/PRD/specs/*.md` for specific requirements.
2. check `docs/PRD/tasks/milestone-*.md` for the current milestone.
3. Implement the feature in `src/features/<feature>`.
4. Update `AGENTS.md` (Active Context) if significant changes occur.

## 5. Directory Structure
```
src/
├── app/              # Layouts, Providers, Routing
├── features/         # Feature-specific domains
│   ├── gestures/     # Browsing & viewing gestures
│   ├── flows/        # Browsing & viewing flows
│   ├── builder/      # Creating custom flows
│   └── player/       # The core guided session engine
├── components/       # Shared UI components (shadcn)
├── lib/              # Utilities, hooks, stores, types
├── content/          # Content source (commit to repo)
│   ├── gestures/
│   ├── flows/
│   └── generated/    # Runtime index
└── motion/           # Animation tokens & primitives
```

## 6. Active Context (Current Status)
- **Phase**: Milestone 1 complete ✅, Milestone 2 in progress
- **M1 Delivered**: Repo scaffold, 12 gestures + 4 flows, gesture library with search/filter/favorites, flow library, player MVP with Prev/Now/Next + controls, motion tokens/primitives, app shell with bottom nav, shadcn properly initialized
- **Two Agents**: Agent 1 owns player (`src/features/player/`), stores (`src/lib/stores/player.ts`), content pipeline (`scripts/`, `src/content/`), types (`src/lib/types/`). Agent 2 owns app shell (`src/app/`), motion (`src/motion/`), UI components (`src/components/ui/`), user data store (`src/lib/stores/user-data.ts`), gestures UI (`src/features/gestures/`)
- **M2 Focus — Agent 1**: Player card components (PrevStepCard, CurrentStepCard, NextStepCard), ProgressOverview, Glance Mode, Wake Lock
- **M2 Focus — Agent 2**: FlowDetail view, flow favorites UI
- **Unblocked for early start**: M3.1 (Audio Chaining), M3.3 (State Persistence), M4.1 (Flow Builder data layer)
